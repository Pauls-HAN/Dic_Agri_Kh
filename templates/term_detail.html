{% extends "base.html" %}

{% block title %}{{ term.korean_term }} - 캄보디아 농업용어 사전{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12 mb-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('index') }}">홈</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('search') }}">검색</a></li>
                <li class="breadcrumb-item active">{{ term.korean_term }}</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <!-- 메인 용어 정보 -->
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h4 class="card-title mb-0">
                    <i class="fas fa-book me-2"></i>용어 상세 정보
                </h4>
                <div class="btn-group" role="group">
                    <a href="{{ url_for('edit_term', term_id=term.id) }}" class="btn btn-outline-light btn-sm">
                        <i class="fas fa-edit"></i> 편집
                    </a>
                    <button type="button" class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal">
                        <i class="fas fa-trash"></i> 삭제
                    </button>
                </div>
            </div>
            <div class="card-body">
                <!-- 용어명 -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="text-primary">{{ term.korean_term }}</h2>
                        <h3 class="text-info text-khmer">{{ term.khmer_term }}</h3>
                        {% if term.english_term %}
                        <p class="text-muted fs-5">{{ term.english_term }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- 기본 정보 -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <strong><i class="fas fa-tag me-2"></i>카테고리:</strong>
                        <span class="badge bg-secondary fs-6">{{ term.category }}</span>
                    </div>
                    <div class="col-md-4">
                        <strong><i class="fas fa-layer-group me-2"></i>난이도:</strong>
                        <span class="badge bg-{{ 'success' if term.difficulty_level == '기초' else ('warning' if term.difficulty_level == '중급' else 'danger') }} fs-6">
                            {{ term.difficulty_level }}
                        </span>
                    </div>
                    <div class="col-md-4">
                        <strong><i class="fas fa-check-circle me-2"></i>검증 상태:</strong>
                        <span class="badge bg-{{ 'success' if term.verified else 'warning' }} fs-6">
                            {{ '검증 완료' if term.verified else '검증 대기' }}
                        </span>
                    </div>
                </div>

                <!-- 정의 -->
                <div class="mb-4">
                    <h5 class="border-bottom pb-2">
                        <i class="fas fa-book-open text-primary me-2"></i>정의
                    </h5>
                    <div class="row">
                        <div class="col-12 mb-3">
                            <h6 class="text-primary">한국어 정의</h6>
                            <p class="fs-6">{{ term.korean_definition }}</p>
                        </div>
                        <div class="col-12">
                            <h6 class="text-info">크메르어 정의</h6>
                            <p class="fs-6 text-khmer">{{ term.khmer_definition }}</p>
                        </div>
                    </div>
                </div>

                <!-- 사용 예시 -->
                {% if term.usage_example %}
                <div class="mb-4">
                    <h5 class="border-bottom pb-2">
                        <i class="fas fa-quote-left text-success me-2"></i>사용 예시
                    </h5>
                    <blockquote class="blockquote">
                        <p class="mb-0">{{ term.usage_example }}</p>
                    </blockquote>
                </div>
                {% endif %}

                <!-- 태그 -->
                {% if term.tags %}
                <div class="mb-4">
                    <h5 class="border-bottom pb-2">
                        <i class="fas fa-tags text-warning me-2"></i>태그
                    </h5>
                    <div>
                        {% for tag in term.tags %}
                        <a href="{{ url_for('search', keyword=tag) }}" class="badge bg-light text-dark me-2 mb-1 text-decoration-none">
                            #{{ tag }}
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- 메타 정보 -->
                <div class="border-top pt-3">
                    <div class="row text-muted small">
                        <div class="col-md-6">
                            <i class="fas fa-calendar-plus me-1"></i>
                            생성일: {{ Utils.formatDate(term.created_date) if term.created_date else '정보 없음' }}
                        </div>
                        <div class="col-md-6">
                            <i class="fas fa-calendar-edit me-1"></i>
                            수정일: {{ Utils.formatDate(term.updated_date) if term.updated_date else '정보 없음' }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 사이드바 -->
    <div class="col-lg-4">
        <!-- 관련 용어 -->
        {% if related_terms %}
        <div class="card mb-3">
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-link me-2"></i>관련 용어
                </h5>
            </div>
            <div class="card-body">
                {% for related in related_terms %}
                <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                    <div>
                        <strong>{{ related.korean_term }}</strong><br>
                        <small class="text-info">{{ related.khmer_term }}</small>
                    </div>
                    <a href="{{ url_for('view_term', term_id=related.id) }}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye"></i>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- 같은 카테고리 용어 -->
        <div class="card mb-3">
            <div class="card-header bg-success text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-layer-group me-2"></i>같은 카테고리
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-2">{{ term.category }} 카테고리의 다른 용어들을 찾아보세요.</p>
                <a href="{{ url_for('search', category=term.category) }}" class="btn btn-sm btn-success">
                    <i class="fas fa-search me-1"></i>{{ term.category }} 용어 보기
                </a>
            </div>
        </div>

        <!-- 빠른 작업 -->
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="card-title mb-0">
                    <i class="fas fa-tools me-2"></i>빠른 작업
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('add_term') }}" class="btn btn-success">
                        <i class="fas fa-plus me-2"></i>새 용어 추가
                    </a>
                    <a href="{{ url_for('search') }}" class="btn btn-primary">
                        <i class="fas fa-search me-2"></i>용어 검색
                    </a>
                    <button type="button" class="btn btn-info" onclick="window.print()">
                        <i class="fas fa-print me-2"></i>인쇄하기
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 삭제 확인 모달 -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">용어 삭제</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>정말로 이 용어를 삭제하시겠습니까?</p>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>주의:</strong> 삭제된 용어는 복구할 수 없습니다.
                </div>
                <div class="bg-light p-3 rounded">
                    <strong>{{ term.korean_term }}</strong> ({{ term.khmer_term }})
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                <form method="POST" action="{{ url_for('delete_term', term_id=term.id) }}" style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>삭제
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// 날짜 포맷팅 함수 (템플릿에서 사용)
const Utils = {
    formatDate: function(dateString) {
        if (!dateString) return '정보 없음';
        const date = new Date(dateString);
        return date.toLocaleDateString('ko-KR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }
};

// 페이지 로드 시 날짜 포맷팅 적용
document.addEventListener('DOMContentLoaded', function() {
    const createdDate = '{{ term.created_date }}';
    const updatedDate = '{{ term.updated_date }}';
    
    // 실제 템플릿 렌더링에서는 서버사이드에서 처리하므로 이 코드는 데모용
});
</script>
{% endblock %}